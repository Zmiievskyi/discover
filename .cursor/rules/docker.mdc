---
globs: Dockerfile,docker-compose.yml
alwaysApply: false
---

# Docker Build Instructions - CRITICAL: Always from project root!

## Setup (one time)
docker buildx use multiplatform-builder
docker login registry.luxembourg-2.cloud.gcore.dev -u r_13863-29099-76-revops-registry+revops -p 67Sn0Sn1psxJ1K8O5ISjdziZaRGMcfbB

## Build Commands - MUST run from project root!

# IMPORTANT: cd to project root first!
cd /Volumes/ssd/code/code-prod/mcp-runbear-pre_grading

# API Server (TypeScript) - build context: api_server/
docker buildx build --no-cache --platform linux/amd64,linux/arm64 \
  -f api_server/Dockerfile \
  -t registry.luxembourg-2.cloud.gcore.dev/13863-29099-76-revops-registry/api-mcp-pre_grading:v6.6 \
  --push \
  api_server

# MCP Server (Python) - build context: . (project root)
# Why root? Dockerfile copies both mcp_server/ AND docs/ folders
docker buildx build --no-cache --platform linux/amd64,linux/arm64 \
  -f mcp_server/Dockerfile \
  -t registry.luxembourg-2.cloud.gcore.dev/13863-29099-76-revops-registry/mcp-runbear-pre_grading:v6.7 \
  --push \
  .

## Production Notes
# - Knowledge Base files are INSIDE Docker image (no volumes!)
# - Container path: /app/docs/knowledge-base/
# - No need to create folders on production VM
# - Everything self-contained in image

## Delete old images (if needed)
skopeo delete docker://registry.luxembourg-2.cloud.gcore.dev/13863-29099-76-revops-registry/api-mcp-pre_grading:v2.6 --creds "r_13863-29099-76-revops-registry+revops:67Sn0Sn1psxJ1K8O5ISjdziZaRGMcfbB"
